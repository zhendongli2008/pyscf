

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; PySCF 1.4.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PySCF 1.4.0 documentation" href="index.html"/>
        <link rel="next" title="Installation" href="install.html"/>
        <link rel="prev" title="An overview of PySCF" href="overview.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                1.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">An overview of PySCF</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-setup">Quick setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-simple-example">A simple example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initializing-a-molecule">Initializing a molecule</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#geometry">Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basis-set">Basis set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-parameters">Other parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#initializing-a-crystal">Initializing a crystal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#d-and-2d-systems">1D and 2D systems</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hf-mp2-mcscf">HF, MP2, MCSCF</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hartree-fock">Hartree-Fock</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mp2-and-mo-integral-transformation">MP2 and MO integral transformation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#casci-and-casscf">CASCI and CASSCF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#restore-an-old-calculation">Restore an old calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#access-ao-integrals">Access AO integrals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#molecular-integrals">molecular integrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#pbc-ao-integrals">PBC AO integrals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-features">Other features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#density-fitting">Density fitting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#customizing-hamiltonian">Customizing Hamiltonian</a></li>
<li class="toctree-l3"><a class="reference internal" href="#symmetry-in-casscf">Symmetry in CASSCF</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="gto.html">gto &#8212; Molecular structure and GTO basis</a></li>
<li class="toctree-l1"><a class="reference internal" href="lib.html">lib &#8212; Helper functions, parameters, and C extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="scf.html">scf &#8212; Mean-field methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="ao2mo.html">ao2mo &#8212; Integral transformations</a></li>
<li class="toctree-l1"><a class="reference internal" href="mcscf.html">mcscf &#8212; Multi-configurational self-consistent field</a></li>
<li class="toctree-l1"><a class="reference internal" href="fci.html">fci &#8212; Full configuration interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="symm.html">symm &#8211; Point group symmetry and spin symmetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="df.html">df &#8212; Density fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="dft.html">dft &#8212; Density functional theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="tddft.html">tddft &#8212; Time dependent density functional theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="cc.html">cc &#8212; Coupled cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="ci.html">ci &#8212; Configuration interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="dmrgscf.html">dmrgscf</a></li>
<li class="toctree-l1"><a class="reference internal" href="fciqmcscf.html">fciqmcscf</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="grad.html">grad &#8212; Analytical nuclear gradients</a></li>
<li class="toctree-l1"><a class="reference internal" href="hessian.html">hessian &#8212; Analytical nuclear Hessian</a></li>
<li class="toctree-l1"><a class="reference internal" href="pbc.html">pbc &#8212; Periodic boundary conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lo.html">lo &#8212; Orbital localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="qmmm.html">qmmm &#8212; QM/MM interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="mrpt.html">mrpt &#8212; Multi-reference perturbation theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="code-rule.html">Code standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">Version history</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PySCF</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<span id="getting-started"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quick-setup">
<h2>Quick setup<a class="headerlink" href="#quick-setup" title="Permalink to this headline">¶</a></h2>
<p>The prerequisites of PySCF include <a class="reference external" href="http://www.cmake.org">cmake</a>,
<a class="reference external" href="http://www.numpy.org/">numpy</a>, <a class="reference external" href="http://www.scipy.org/">scipy</a>,
and <a class="reference external" href="http://www.h5py.org/">h5py</a>.  On the Ubuntu host, you can quickly
install them:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ sudo apt-get install python-h5py python-scipy cmake
</pre></div>
</div>
<p>Then download the latest version of <a class="reference external" href="https://github.com/sunqm/pyscf.git/">pyscf</a>
and build C extensions in <code class="file docutils literal"><span class="pre">pyscf/lib</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ git clone https://github.com/sunqm/pyscf
$ cd pyscf/lib
$ mkdir build
$ cd build
$ cmake ..
$ make
</pre></div>
</div>
<p>Finally, update the Python runtime path <code class="code docutils literal"><span class="pre">PYTHONPATH</span></code> (assuming pyscf
is put in /home/abc, replace it with your own path):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ echo &#39;export PYTHONPATH=/home/abc:$PYTHONPATH&#39; &gt;&gt; ~/.bashrc
$ source ~/.bashrc
</pre></div>
</div>
<p>To ensure the installation is successed, start a Python shell, and type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyscf</span>
</pre></div>
</div>
<p>If you got errors like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ne">ImportError</span><span class="p">:</span> <span class="n">No</span> <span class="n">module</span> <span class="n">named</span> <span class="n">pyscf</span>
</pre></div>
</div>
<p>It&#8217;s very possible that you put <code class="docutils literal"><span class="pre">/home/abc/pyscf</span></code> in <code class="code docutils literal"><span class="pre">PYTHONPATH</span></code>.
You need to remove the <code class="docutils literal"><span class="pre">/pyscf</span></code> in that string and try
<code class="docutils literal"><span class="pre">import</span> <span class="pre">pyscf</span></code> in the python shell again.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The quick setup does not provide the best performance.
Please see <a class="reference internal" href="install.html#installing"><span class="std std-ref">Installation</span></a> for the installation with optimized libraries.</p>
</div>
</div>
<div class="section" id="a-simple-example">
<h2>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h2>
<p>Here is an example to run HF calculation for hydrogen molecule:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;H 0 0 0; H 0 0 1.2&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;ccpvdz&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="go">converged SCF energy = -1.06111199785749</span>
<span class="go">-1.06111199786</span>
</pre></div>
</div>
</div>
<div class="section" id="initializing-a-molecule">
<h2>Initializing a molecule<a class="headerlink" href="#initializing-a-molecule" title="Permalink to this headline">¶</a></h2>
<p>There are three ways to define and initialize a molecule.  The first is to use
the keyword arguments of <code class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></code> to initialize a molecule:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The second way is to assign the geometry, basis etc. to <code class="xref py py-class docutils literal"><span class="pre">Mole</span></code>
object, then call <code class="xref py py-meth docutils literal"><span class="pre">build()</span></code> function to initialize the
molecule:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>The third way is to use the shortcut function <code class="xref py py-func docutils literal"><span class="pre">Mole.M()</span></code>.  This
function pass all arguments to <code class="xref py py-func docutils literal"><span class="pre">Mole.build()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;O 0 0 0; H  0 1 0; H 0 0 1&#39;&#39;&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Either way, you may have noticed two keywords <code class="docutils literal"><span class="pre">atom</span></code> and <code class="docutils literal"><span class="pre">basis</span></code>.
They are used to hold the molecular geometry and basis sets.</p>
<div class="section" id="geometry">
<h3>Geometry<a class="headerlink" href="#geometry" title="Permalink to this headline">¶</a></h3>
<p>Molecular geometry can be input in Cartesian format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;O 0, 0, 0</span>
<span class="gp">... </span><span class="s1">H   0  1  0; H 0, 0, 1&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>The atoms in the molecule are represented by an element symbol plus three
numbers for coordinates.  Different atoms should be separated by <code class="docutils literal"><span class="pre">;</span></code> or line
break. In the same atom, <code class="docutils literal"><span class="pre">,</span></code> can be used to separate different items.
Z-matrix input format is also supported by the input parser:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;O</span>
<span class="gp">... </span><span class="s1">H, 1, 1.2;  H   1 1.2   2 105&#39;&#39;&#39;</span>
</pre></div>
</div>
<p>Similarly,  different atoms need to be separated by <code class="docutils literal"><span class="pre">;</span></code> or line break.
If you need to label an atom to distinguish it from the rest, you can prefix
or suffix number or special characters <code class="docutils literal"><span class="pre">1234567890~!&#64;#$%^&amp;*()_+.?:&lt;&gt;[]{}|</span></code>
(except <code class="docutils literal"><span class="pre">,</span></code> and <code class="docutils literal"><span class="pre">;</span></code>) to an atomic symbol.  With this decoration, you can
specify different basis sets, or masses, or nuclear models for different atoms:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;8 0 0 0; h:1 0 1 0; H@2 0 0&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="s1">&#39;sto-3g&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;cc-pvdz&#39;</span><span class="p">,</span> <span class="s1">&#39;H@2&#39;</span><span class="p">:</span> <span class="s1">&#39;6-31G&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">_atom</span><span class="p">)</span>
<span class="go">[[&#39;O&#39;, [0.0, 0.0, 0.0]], [&#39;H:1&#39;, [0.0, 1.0, 0.0]], [&#39;H@2&#39;, [0.0, 0.0]]]</span>
</pre></div>
</div>
</div>
<div class="section" id="basis-set">
<h3>Basis set<a class="headerlink" href="#basis-set" title="Permalink to this headline">¶</a></h3>
<p>The simplest way is to assign a string of basis name to <code class="xref py py-attr docutils literal"><span class="pre">mol.basis</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto3g&#39;</span>
</pre></div>
</div>
<p>This input will apply the specified basis set to all atoms.  The basis name in
the string is case insensitive.  White space, dash and underscore in the basis
name are all ignored.  If different basis sets are required for different
elements,  a python <code class="docutils literal"><span class="pre">dict</span></code> can be assigned to the basis attribute:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="s1">&#39;sto3g&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="s1">&#39;6-31g&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>You can find more examples in section <a class="reference internal" href="gto.html#input-basis"><span class="std std-ref">Input Basis</span></a> and in the file
<code class="file docutils literal"><span class="pre">examples/gto/04-input_basis.py</span></code>.</p>
</div>
<div class="section" id="other-parameters">
<h3>Other parameters<a class="headerlink" href="#other-parameters" title="Permalink to this headline">¶</a></h3>
<p>You can assign more informations to the molecular object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">nucmod</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">mol</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;O1&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-attr docutils literal"><span class="pre">Mole.spin</span></code> is <em>2S</em>, the alpha and beta electron number difference.</p>
</div>
<p><code class="xref py py-class docutils literal"><span class="pre">Mole</span></code> also defines some global parameters.  You can control the
print level globally with <code class="xref py py-attr docutils literal"><span class="pre">verbose</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p>The print level can be 0 (quite, no output) to 9 (very noise).  Mostly,
the useful messages are printed at level 4 (info), and 5 (debug).
You can also specify the place where to write the output messages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;path/to/my_log.txt&#39;</span>
</pre></div>
</div>
<p>Without assigning this variable, messages will be dumped to <code class="xref py py-attr docutils literal"><span class="pre">sys.stdout</span></code>.
You can control the maximum memory usage globally:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mol</span><span class="o">.</span><span class="n">max_memory</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c1"># MB</span>
</pre></div>
</div>
<p>The default size can be defined with shell environment variable <cite>PYSCF_MAX_MEMORY</cite></p>
<p><code class="xref py py-attr docutils literal"><span class="pre">output</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">max_memory</span></code> can be assigned from command
line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ python example.py -o /path/to/my_log.txt -m 1000
</pre></div>
</div>
</div>
</div>
<div class="section" id="initializing-a-crystal">
<h2>Initializing a crystal<a class="headerlink" href="#initializing-a-crystal" title="Permalink to this headline">¶</a></h2>
<p>Initialization a crystal unit cell is very similar to the initialization
molecular object.  Here, <a class="reference internal" href="pbc/gto.html#pyscf.pbc.gto.Cell" title="pyscf.pbc.gto.Cell"><code class="xref py py-class docutils literal"><span class="pre">pyscf.pbc.gto.Cell</span></code></a> class should be used
instead of the <code class="xref py py-class docutils literal"><span class="pre">pyscf.gto.Mole</span></code> class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="k">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Cell</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;H  0 0 0; H 1 1 1&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;gth-dzvp&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">pseudo</span> <span class="o">=</span> <span class="s1">&#39;gth-pade&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>The crystal initialization requires an extra parameter <code class="xref py py-attr docutils literal"><span class="pre">cell.a</span></code> which
represents the lattice vectors. In the above example, we specified
<code class="xref py py-attr docutils literal"><span class="pre">cell.pseudo</span></code> for the pseudo-potential of the system which is an optional
parameter.  The input format of basis set is the same to that of <code class="xref py py-class docutils literal"><span class="pre">Mole</span></code>
object.  The other attributes of <code class="xref py py-class docutils literal"><span class="pre">Mole</span></code> object such as <code class="xref py py-attr docutils literal"><span class="pre">verbose</span></code>,
<code class="xref py py-attr docutils literal"><span class="pre">max_memory</span></code>, <code class="xref py py-attr docutils literal"><span class="pre">spin</span></code> can also be used in the crystal systems.
More details of the crystal <code class="xref py py-class docutils literal"><span class="pre">Cell</span></code> object and the relevant input
parameters are documented in <a class="reference internal" href="pbc/gto.html#pbc-gto"><span class="std std-ref">pbc.gto &#8212; Crystal cell structure</span></a>.</p>
<div class="section" id="d-and-2d-systems">
<h3>1D and 2D systems<a class="headerlink" href="#d-and-2d-systems" title="Permalink to this headline">¶</a></h3>
<p>PySCF PBC module supports the low-dimensional PBC systems.  You can initialize
the attribute <code class="xref py py-attr docutils literal"><span class="pre">cell.dimension</span></code> to specify the dimension of the system:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="k">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Cell</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;H  0 0 0; H 1 1 0&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto3g&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>When <code class="xref py py-attr docutils literal"><span class="pre">cell.dimension</span></code> is specified, a vacuum of infinite size will be
applied on certain dimension(s).  More specifically, when <code class="xref py py-attr docutils literal"><span class="pre">cell.dimension</span></code>
is 2, the z-direction will be treated as infinite large and the xy-plane
constitutes the periodic surface. When <code class="xref py py-attr docutils literal"><span class="pre">cell.dimension</span></code> is 1, y and z axes
are treated as vacuum thus wire is placed on the x axis.  When
<code class="xref py py-attr docutils literal"><span class="pre">cell.dimension</span></code> is 0, all three directions are vacuum.  The PBC system is
actually the same to the molecular system.</p>
</div>
</div>
<div class="section" id="hf-mp2-mcscf">
<h2>HF, MP2, MCSCF<a class="headerlink" href="#hf-mp2-mcscf" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hartree-fock">
<h3>Hartree-Fock<a class="headerlink" href="#hartree-fock" title="Permalink to this headline">¶</a></h3>
<p>Now we are ready to study electronic structure theory with pyscf.  Let&#8217;s
take oxygen molecule as the first example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;o2.log&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;O 0 0 0; O 0 0 1.2&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<p>Apply non-relativistic Hartree-Fock:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(HF) = </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">m</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">E(HF) = -149.544214749</span>
</pre></div>
</div>
<p>The ground state of oxygen molecule should be triplet.  So we change the spin to
<code class="docutils literal"><span class="pre">2</span></code> (2 more alpha electrons than beta electrons):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_tri</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># two &quot;0&quot;s to prevent dumping input and parsing command line</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">o2_tri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">rhf3</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-149.609461122</span>
</pre></div>
</div>
<p>Run UHF:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">uhf3</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UHF</span><span class="p">(</span><span class="n">o2_tri</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">uhf3</span><span class="o">.</span><span class="n">scf</span><span class="p">())</span>
<span class="go">-149.628992314</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S^2 = </span><span class="si">%f</span><span class="s1">, 2S+1 = </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">uhf3</span><span class="o">.</span><span class="n">spin_square</span><span class="p">())</span>
<span class="go">S^2 = 2.032647, 2S+1 = 3.021686</span>
</pre></div>
</div>
<p>where we called <code class="xref py py-func docutils literal"><span class="pre">mf.scf()</span></code>, which is an alias name of <code class="docutils literal"><span class="pre">mf.kernel</span></code>.
You can impose symmetry:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">symmetry</span> <span class="o">=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">o2_sym</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">o2_sym</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-149.609461122</span>
</pre></div>
</div>
<p>Here we rebuild the molecule because we need to initialize the point group
symmetry information, symmetry adapted orbitals.  We can check the occupancy for
each irreducible representations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">symm</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">myocc</span><span class="p">(</span><span class="n">mf</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">mol</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mol</span>
<span class="gp">... </span>    <span class="n">irrep_id</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">irrep_id</span>
<span class="gp">... </span>    <span class="n">so</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">symm_orb</span>
<span class="gp">... </span>    <span class="n">orbsym</span> <span class="o">=</span> <span class="n">symm</span><span class="o">.</span><span class="n">label_orb_symm</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">irrep_id</span><span class="p">,</span> <span class="n">so</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">doccsym</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orbsym</span><span class="p">)[</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">2</span><span class="p">]</span>
<span class="gp">... </span>    <span class="n">soccsym</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">orbsym</span><span class="p">)[</span><span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">ir</span><span class="p">,</span><span class="n">irname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">irrep_name</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, double-occ = </span><span class="si">%d</span><span class="s1">, single-occ = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
<span class="gp">... </span>              <span class="p">(</span><span class="n">irname</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">doccsym</span><span class="o">==</span><span class="n">ir</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">soccsym</span><span class="o">==</span><span class="n">ir</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">myocc</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="p">)</span>
<span class="go">Ag, double-occ = 3, single-occ = 0</span>
<span class="go">B1g, double-occ = 0, single-occ = 0</span>
<span class="go">B2g, double-occ = 0, single-occ = 1</span>
<span class="go">B3g, double-occ = 0, single-occ = 1</span>
<span class="go">Au, double-occ = 0, single-occ = 0</span>
<span class="go">B1u, double-occ = 2, single-occ = 0</span>
<span class="go">B2u, double-occ = 1, single-occ = 0</span>
<span class="go">B3u, double-occ = 1, single-occ = 0</span>
</pre></div>
</div>
<p>To label the irreducible representation of given orbitals,
<code class="xref py py-func docutils literal"><span class="pre">symm.label_orb_symm()</span></code> needs the information of the point group
symmetry which are initialized in <code class="docutils literal"><span class="pre">mol</span></code> object, including the <cite>id</cite> of
irreducible representations <code class="xref py py-attr docutils literal"><span class="pre">Mole.irrep_id</span></code> and the symmetry
adapted basis <code class="xref py py-attr docutils literal"><span class="pre">Mole.symm_orb</span></code>.  For each <code class="xref py py-attr docutils literal"><span class="pre">irrep_id</span></code>,
<code class="xref py py-attr docutils literal"><span class="pre">Mole.irrep_name</span></code> gives the associated irrep symbol (A1, B1 ...).
In the SCF calculation, you can control the symmetry of the wave
function by assigning the number of alpha electrons and beta electrons
<cite>(alpha,beta)</cite> for some irreps:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">irrep_nelec</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;B2g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;B3g&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;B2u&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;B3u&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">kernel</span><span class="p">())</span>
<span class="go">-148.983117701</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rhf3_sym</span><span class="o">.</span><span class="n">get_irrep_nelec</span><span class="p">()</span>
<span class="go">{&#39;Ag&#39; : (3, 3), &#39;B1g&#39;: (0, 0), &#39;B2g&#39;: (1, 1), &#39;B3g&#39;: (1, 1), &#39;Au&#39; : (0, 0), &#39;B1u&#39;: (1, 0), &#39;B2u&#39;: (0, 1), &#39;B3u&#39;: (1, 0)}</span>
</pre></div>
</div>
<p>More informations of the calculation can be found in the output file <code class="docutils literal"><span class="pre">o2.log</span></code>.</p>
</div>
<div class="section" id="mp2-and-mo-integral-transformation">
<h3>MP2 and MO integral transformation<a class="headerlink" href="#mp2-and-mo-integral-transformation" title="Permalink to this headline">¶</a></h3>
<p>Next, we compute the correlation energy with <code class="xref py py-mod docutils literal"><span class="pre">mp.mp2</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">mp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mp2</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">MP2</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(MP2) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mp2</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(MP2) = -0.379359288</span>
</pre></div>
</div>
<p>This is the correlation energy of singlet ground state.  For the triplet
state, we can write a function to compute the correlation energy</p>
<div class="math">
\[E_{corr} = \frac{1}{4}\sum_{ijab}
         \frac{\langle ij||ab \rangle \langle ab||ij \rangle}
         {\epsilon_i + \epsilon_j - \epsilon_a - \epsilon_b}\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myump2</span><span class="p">(</span><span class="n">mf</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
    <span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">ao2mo</span>
    <span class="c1"># As UHF objects, mo_energy, mo_occ, mo_coeff are two-item lists</span>
    <span class="c1"># (the first item for alpha spin, the second for beta spin).</span>
    <span class="n">mo_energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_energy</span>
    <span class="n">mo_occ</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_occ</span>
    <span class="n">mo_coeff</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span><span class="n">mo_coeff</span><span class="p">[</span><span class="mi">1</span><span class="p">][:,</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">eo</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">ev</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">],</span><span class="n">mo_energy</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">no</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">nv</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">noa</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nva</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">mo_occ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">o</span><span class="p">,</span><span class="n">v</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">no</span><span class="p">,</span><span class="n">nv</span><span class="p">,</span><span class="n">no</span><span class="p">,</span><span class="n">nv</span><span class="p">)</span>
    <span class="n">eri</span><span class="p">[:</span><span class="n">noa</span><span class="p">,</span><span class="n">nva</span><span class="p">:]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[</span><span class="n">noa</span><span class="p">:,:</span><span class="n">nva</span><span class="p">]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[:,:,:</span><span class="n">noa</span><span class="p">,</span><span class="n">nva</span><span class="p">:]</span> <span class="o">=</span> <span class="n">eri</span><span class="p">[:,:,</span><span class="n">noa</span><span class="p">:,:</span><span class="n">nva</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">eri</span> <span class="o">-</span> <span class="n">eri</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eov</span> <span class="o">=</span> <span class="n">eo</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">ev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">de</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eov</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">eov</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">emp2</span> <span class="o">=</span> <span class="o">.</span><span class="mi">25</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;iajb,iajb,iajb-&gt;&#39;</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">de</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">emp2</span>
</pre></div>
</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(UMP2) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">myump2</span><span class="p">(</span><span class="n">uhf3</span><span class="p">))</span>
<span class="go">-0.346926068</span>
</pre></div>
</div>
<p>In this example, we concatenate <span class="math">\(\alpha\)</span> and <span class="math">\(\beta\)</span> orbitals to
mimic the spin-orbitals.  After integral transformation, we zeroed out the
integrals of different spin.  Here, the <code class="xref py py-mod docutils literal"><span class="pre">ao2mo</span></code> module provides the general
2-electron MO integral transformation.  Using this module, you are able to do
<em>arbitrary</em> integral transformation for <em>arbitrary</em> integrals. For example, the
following code gives the <code class="docutils literal"><span class="pre">(ov|vv)</span></code> type integrals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">ao2mo</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">h5py</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mocc</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">m</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mvir</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">m</span><span class="o">.</span><span class="n">mo_occ</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">mocc</span><span class="p">,</span><span class="n">mvir</span><span class="p">,</span><span class="n">mvir</span><span class="p">,</span><span class="n">mvir</span><span class="p">),</span> <span class="s1">&#39;tmp.h5&#39;</span><span class="p">,</span> <span class="n">compact</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">feri</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="s1">&#39;tmp.h5&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ovvv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feri</span><span class="p">[</span><span class="s1">&#39;eri_mo&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ovvv</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(160, 400)</span>
</pre></div>
</div>
<p>We pass <code class="docutils literal"><span class="pre">compact=False</span></code> to <code class="xref py py-func docutils literal"><span class="pre">ao2mo.general()</span></code> to prevent the
function using the permutation symmetry between the virtual-virtual pair
of <code class="docutils literal"><span class="pre">|vv)</span></code>.  So the shape of <code class="docutils literal"><span class="pre">ovvv</span></code> corresponds to 8 occupied
orbitals by 20 virtual orbitals for electron 1 <code class="docutils literal"><span class="pre">(ov|</span></code> and 20 by 20 for
electron 2 <code class="docutils literal"><span class="pre">|vv)</span></code>.  In the following example, we transformed the
analytical gradients of 2-electron integrals</p>
<div class="math">
\[\langle (\frac{\partial}{\partial R} \varphi_i) \varphi_k | \varphi_j \varphi_l \rangle
= \int \frac{\frac{\partial\varphi_i(r_1)}{\partial R}
\varphi_j(r_1) \varphi_k(r_2)\varphi_l(r_2)}{|r_1-r_2|} dr_1 dr_2\]</div>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">nocc</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">//</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">co</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,:</span><span class="n">nocc</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cv</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">mo_coeff</span><span class="p">[:,</span><span class="n">nocc</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nvir</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">general</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="p">(</span><span class="n">co</span><span class="p">,</span><span class="n">cv</span><span class="p">,</span><span class="n">co</span><span class="p">,</span><span class="n">cv</span><span class="p">),</span> <span class="n">intor</span><span class="o">=</span><span class="s1">&#39;int2e_ip1_sph&#39;</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eri</span> <span class="o">=</span> <span class="n">eri</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">nvir</span><span class="p">,</span> <span class="n">nocc</span><span class="p">,</span> <span class="n">nvir</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">eri</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">(3, 8, 20, 8, 20)</span>
</pre></div>
</div>
</div>
<div class="section" id="casci-and-casscf">
<h3>CASCI and CASSCF<a class="headerlink" href="#casci-and-casscf" title="Permalink to this headline">¶</a></h3>
<p>The two classes <code class="xref py py-class docutils literal"><span class="pre">mcscf.CASCI</span></code> and <code class="xref py py-class docutils literal"><span class="pre">mcscf.CASSCF</span></code> provided
by <code class="xref py py-mod docutils literal"><span class="pre">mcscf</span></code> have the same initialization interface:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">mcscf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASCI</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(CASCI) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">casci</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASCI) = -149.601051</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.613191</span>
</pre></div>
</div>
<p>In this example, the CAS space is (6e, 4o): the third argument for
CASCI/CASSCF is the size of CAS space; the fourth argument is the number
of electrons.  By default, the CAS solver determines the alpha-electron number
and beta-electron number based on the attribute <code class="xref py py-attr docutils literal"><span class="pre">Mole.spin</span></code>.  In the
above example, the number of alpha electrons is equal to the number of beta
electrons, since the <code class="docutils literal"><span class="pre">mol</span></code> object is initialized with <code class="docutils literal"><span class="pre">spin=0</span></code>.  The spin
multiplicity of the CASSCF/CASCI solver can be changed by the fourth argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.609461</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;S^2 = </span><span class="si">%.7f</span><span class="s1">, 2S+1 = </span><span class="si">%.7f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">spin_square</span><span class="p">(</span><span class="n">mc</span><span class="p">))</span>
<span class="go">S^2 = 2.0000000, 2S+1 = 3.0000000</span>
</pre></div>
</div>
<p>The two integers in the tuple represent the number of alpha and beta electrons.
Although it is a triplet state, the solution might not be correct since the
CASSCF is based on the incorrect singlet HF ground state.  Starting from the
ROHF ground state, we have:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">rhf3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(CASSCF) = </span><span class="si">%.9g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<span class="go">E(CASSCF) = -149.646746</span>
</pre></div>
</div>
<p>The energy is lower than the RHF initial guess.
.. We can also use the UHF ground
.. state to start a CASSCF calculation::
..
..   &gt;&gt;&gt; mc = mcscf.CASSCF(uhf3, 4, 6)
..   &gt;&gt;&gt; print(&#8216;E(CASSCF) = %.9g&#8217; % mc.kernel()[0])
..   E(CASSCF) = -149.661324
..   &gt;&gt;&gt; print(&#8216;S^2 = %.7f, 2S+1 = %.7f&#8217; % mcscf.spin_square(mc))
..   S^2 = 3.9713105, 2S+1 = 4.1091656
..
.. Woo, the total energy is even lower.  But the spin is contaminated.</p>
</div>
</div>
<div class="section" id="restore-an-old-calculation">
<h2>Restore an old calculation<a class="headerlink" href="#restore-an-old-calculation" title="Permalink to this headline">¶</a></h2>
<p>There is no <cite>restart</cite> mechanism available in PySCF package.  Calculations can be
&#8220;restarted&#8221; by the proper initial guess.  For SCF, the initial guess can be
prepared in many ways.  One is to read the <code class="docutils literal"><span class="pre">chkpoint</span></code> file
which is generated in the previous or other calculations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="s1">&#39;/path/to/chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">init_guess</span> <span class="o">=</span> <span class="s1">&#39;chkfile&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">/path/to/chkfile</span></code> can be found in the output in the calculation
(if mol.verbose &gt;= 4, the filename of the chkfile will be dumped in the output).
By setting <code class="xref py py-attr docutils literal"><span class="pre">chkfile</span></code> and <code class="xref py py-attr docutils literal"><span class="pre">init_guess</span></code>, the SCF module can read the
molecular orbitals from the given <code class="xref py py-attr docutils literal"><span class="pre">chkfile</span></code> and rotate them to
representation of the required basis.  The example
<code class="file docutils literal"><span class="pre">examples/scf/15-initial_guess.py</span></code> records other methods to generate SCF
initial guess.</p>
<p>Initial guess can be fed to the calculation directly.  For example, we can read
the initial guess form a chkfile and achieve the same effects as the on in the
previous example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">scf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dm</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">hf</span><span class="o">.</span><span class="n">from_chk</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="s1">&#39;/path/to/chkfile&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">dm</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal"><span class="pre">scf.hf.from_chk()</span></code> reads the chkpoint file and generates the corresponding
density matrix represented in the required basis.</p>
<p>Initial guess <code class="docutils literal"><span class="pre">chkfile</span></code> is not limited to the calculation based on the same
molecular and same basis set.  One can first do a cheap SCF (with
small basis sets) or a model SCF (dropping a few atoms, or charged
system), then use <code class="xref py py-func docutils literal"><span class="pre">scf.hf.from_chk()</span></code> to project the
results to the target basis sets.</p>
<p>To restart a CASSCF calculation, you need prepare either CASSCF orbitals
or CI coefficients (not that useful unless doing a DMRG-CASSCF calculation) or
both.  For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">lib</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Restart CASSCF from previous calculation.</span>

<span class="sd">There is no &quot;restart&quot; keyword for CASSCF solver.  The CASSCF solver is</span>
<span class="sd">completely controlled by initial guess.  So we can mimic the restart feature</span>
<span class="sd">by providing proper initial guess from previous calculation.</span>

<span class="sd">We need assign the .chkfile a string to indicate the file where to save the</span>
<span class="sd">CASSCF intermediate results.  Then we can &quot;restart&quot; the calculation from the</span>
<span class="sd">intermediate results.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">tmpchk</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">()</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;C 0 0 0; C 0 0 1.2&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">chkfile</span> <span class="o">=</span> <span class="n">tmpchk</span><span class="o">.</span><span class="n">name</span>
<span class="n">mc</span><span class="o">.</span><span class="n">max_cycle_macro</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1">#######################################################################</span>
<span class="c1">#</span>
<span class="c1"># Assuming the CASSCF was interrupted.  Intermediate data were saved in</span>
<span class="c1"># tmpchk file.  Here we read the chkfile to restart the previous calculation.</span>
<span class="c1">#</span>
<span class="c1">#######################################################################</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;C 0 0 0; C 0 0 1.2&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">),</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mo</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">chkfile</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">tmpchk</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;mcscf/mo_coeff&#39;</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">(</span><span class="n">mo</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="access-ao-integrals">
<h2>Access AO integrals<a class="headerlink" href="#access-ao-integrals" title="Permalink to this headline">¶</a></h2>
<div class="section" id="molecular-integrals">
<h3>molecular integrals<a class="headerlink" href="#molecular-integrals" title="Permalink to this headline">¶</a></h3>
<p>PySCF uses <a class="reference external" href="https://github.com/sunqm/libcint">Libcint</a> library as the AO
integral engine.  It provides simple interface function <code class="xref py py-func docutils literal"><span class="pre">getints_by_shell()</span></code>
to evaluate integrals.  The following example evaluates 3-center 2-electron
integrals with this function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">df</span>
<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;O 0 0 0; h 0 -0.757 0.587; h 0 0.757 0.587&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;cc-pvdz&#39;</span><span class="p">)</span>
<span class="n">auxmol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s1">&#39;O 0 0 0; h 0 -0.757 0.587; h 0 0.757 0.587&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;weigend&#39;</span><span class="p">)</span>
<span class="n">pmol</span> <span class="o">=</span> <span class="n">mol</span> <span class="o">+</span> <span class="n">auxmol</span>
<span class="n">nao</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
<span class="n">naux</span> <span class="o">=</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
<span class="n">eri3c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nao</span><span class="p">,</span><span class="n">nao</span><span class="p">,</span><span class="n">naux</span><span class="p">))</span>
<span class="n">pi</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
    <span class="n">pj</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">pk</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
            <span class="n">shls</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">buf</span> <span class="o">=</span> <span class="n">pmol</span><span class="o">.</span><span class="n">intor_by_shell</span><span class="p">(</span><span class="s1">&#39;int3c2e_sph&#39;</span><span class="p">,</span> <span class="n">shls</span><span class="p">)</span>
            <span class="n">di</span><span class="p">,</span> <span class="n">dj</span><span class="p">,</span> <span class="n">dk</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">eri3c</span><span class="p">[</span><span class="n">pi</span><span class="p">:</span><span class="n">pi</span><span class="o">+</span><span class="n">di</span><span class="p">,</span><span class="n">pj</span><span class="p">:</span><span class="n">pj</span><span class="o">+</span><span class="n">dj</span><span class="p">,</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">dk</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span>
            <span class="n">pk</span> <span class="o">+=</span> <span class="n">dk</span>
        <span class="n">pj</span> <span class="o">+=</span> <span class="n">dj</span>
    <span class="n">pi</span> <span class="o">+=</span> <span class="n">di</span>
</pre></div>
</div>
<p>Here we load the Weigend density fitting basis to <code class="docutils literal"><span class="pre">auxmol</span></code> and append the
basis to normal orbital basis which was initialized in <code class="docutils literal"><span class="pre">mol</span></code>.  In the result
<code class="docutils literal"><span class="pre">pmol</span></code> object, the first <code class="docutils literal"><span class="pre">mol.nbas</span></code> shells are the orbital basis and
the next <code class="docutils literal"><span class="pre">auxmol.nbas</span></code> are auxiliary basis.  The three nested loops run over
all integrals for the three index integral <cite>(ij|K)</cite>.  Similarly, we can compute
the two center Coulomb integrals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">eri2c</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">naux</span><span class="p">,</span><span class="n">naux</span><span class="p">))</span>
<span class="n">pk</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span> <span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">):</span>
        <span class="n">shls</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">pmol</span><span class="o">.</span><span class="n">intor_by_shell</span><span class="p">(</span><span class="s1">&#39;int2c2e_sph&#39;</span><span class="p">,</span> <span class="n">shls</span><span class="p">)</span>
        <span class="n">dk</span><span class="p">,</span> <span class="n">dl</span> <span class="o">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">eri2c</span><span class="p">[</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">dk</span><span class="p">,</span><span class="n">pl</span><span class="p">:</span><span class="n">pl</span><span class="o">+</span><span class="n">dl</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span>
        <span class="n">pl</span> <span class="o">+=</span> <span class="n">dl</span>
    <span class="n">pk</span> <span class="o">+=</span> <span class="n">dk</span>
</pre></div>
</div>
<p>Now we can use the two-center integrals and three-center integrals to implement
the density fitting Hartree-Fock code.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_vhf</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">dm</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">naux</span> <span class="o">=</span> <span class="n">eri2c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">nao</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">()</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijp,ij-&gt;p&#39;</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">eri2c</span><span class="p">,</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">jmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;p,ijp-&gt;ij&#39;</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">)</span>
    <span class="n">kpj</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijp,jk-&gt;ikp&#39;</span><span class="p">,</span> <span class="n">eri3c</span><span class="p">,</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">pik</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">eri2c</span><span class="p">,</span> <span class="n">kpj</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">naux</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">kmat</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;pik,kjp-&gt;ij&#39;</span><span class="p">,</span> <span class="n">pik</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">naux</span><span class="p">,</span><span class="n">nao</span><span class="p">,</span><span class="n">nao</span><span class="p">),</span> <span class="n">eri3c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jmat</span> <span class="o">-</span> <span class="n">kmat</span> <span class="o">*</span> <span class="o">.</span><span class="mi">5</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_veff</span> <span class="o">=</span> <span class="n">get_vhf</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E(DF-HF) = </span><span class="si">%.12f</span><span class="s1">, ref = </span><span class="si">%.12f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">(),</span> <span class="n">scf</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span><span class="o">.</span><span class="n">kernel</span><span class="p">()))</span>
</pre></div>
</div>
<p>Your screen should output</p>
<blockquote>
<div><div class="line-block">
<div class="line">E(DF-HF) = -76.025936299702, ref = -76.025936299702</div>
</div>
</div></blockquote>
<p>Evaluating the integrals with nested loops and <code class="xref py py-func docutils literal"><span class="pre">mol.intor_by_shell()</span></code> method is
inefficient.  It is preferred to load integrals in bulk and this can be done
with <code class="xref py py-func docutils literal"><span class="pre">mol.intor()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">eri2c</span> <span class="o">=</span> <span class="n">auxmol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int2c2e_sph&#39;</span><span class="p">)</span>
<span class="n">eri3c</span> <span class="o">=</span> <span class="n">pmol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int3c2e_sph&#39;</span><span class="p">,</span> <span class="n">shls_slice</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="p">,</span><span class="n">mol</span><span class="o">.</span><span class="n">nbas</span><span class="o">+</span><span class="n">auxmol</span><span class="o">.</span><span class="n">nbas</span><span class="p">))</span>
<span class="n">eri3c</span> <span class="o">=</span> <span class="n">eri3c</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">(),</span> <span class="n">mol</span><span class="o">.</span><span class="n">nao_nr</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-func docutils literal"><span class="pre">mol.intor()</span></code> method can be used to evaluate one-electron integrals,
two-electron integrals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">hcore</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int1e_nuc_sph&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int1e_kin_sph&#39;</span><span class="p">)</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp_sph&#39;</span><span class="p">)</span>
<span class="n">eri</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">intor</span><span class="p">(</span><span class="s1">&#39;int2e_sph&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>There is a long list of supported AO integrals.  See <a class="reference internal" href="gto.html#gto-moleintor"><span class="std std-ref">moleintor</span></a>.</p>
</div>
<div class="section" id="pbc-ao-integrals">
<h3>PBC AO integrals<a class="headerlink" href="#pbc-ao-integrals" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-func docutils literal"><span class="pre">mol.intor()</span></code> can only be used to evaluate the integrals with open boundary
conditions.  When the periodic boundary conditions of crystal systems are
studied, you need to use <code class="xref py py-func docutils literal"><span class="pre">pbc.Cell.pbc_intor()</span></code> function to evaluate the
integrals of short-range operators, such as the overlap, kinetic matrix:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="k">import</span> <span class="n">gto</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Cell</span><span class="p">()</span>
<span class="n">cell</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;H 0 0 0; H 1 1 1&#39;</span>
<span class="n">cell</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.</span>
<span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">pbc_intor</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp_sph&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By default, <code class="xref py py-func docutils literal"><span class="pre">pbc.Cell.pbc_intor()</span></code> function returns the <span class="math">\(\Gamma\)</span>-point
integrals.  If k-points are specified, function <code class="xref py py-func docutils literal"><span class="pre">pbc.Cell.pbc_intor()</span></code> can
also evaluate the k-point integrals:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">kpts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># 8 k-points</span>
<span class="n">overlap</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">pbc_intor</span><span class="p">(</span><span class="s1">&#39;int1e_ovlp_sph&#39;</span><span class="p">,</span> <span class="n">kpts</span><span class="o">=</span><span class="n">kpts</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-func docutils literal"><span class="pre">pbc.Cell.pbc_intor()</span></code> can only be used to evaluate the short-range
integrals.  PBC density fitting method has to be used to compute the
long-range operator such as nuclear attraction integrals, Coulomb integrals.</p>
</div>
<p>The two-electron Coulomb integrals can be evaluated with PBC density fitting
methods:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="k">import</span> <span class="n">df</span>
<span class="n">eri</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">DF</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span><span class="o">.</span><span class="n">get_eri</span><span class="p">()</span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="pbc/df.html#pbc-df"><span class="std std-ref">pbc.df &#8212; PBC denisty fitting</span></a> for more details of the PBC density fitting module.</p>
</div>
</div>
<div class="section" id="other-features">
<h2>Other features<a class="headerlink" href="#other-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="density-fitting">
<h3>Density fitting<a class="headerlink" href="#density-fitting" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">scf</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Density fitting method by decorating the scf object with scf.density_fit function.</span>

<span class="sd">There is no flag to control the program to do density fitting for 2-electron</span>
<span class="sd">integration.  The way to call density fitting is to decorate the existed scf</span>
<span class="sd">object with scf.density_fit function.</span>

<span class="sd">NOTE scf.density_fit function generates a new object, which works exactly the</span>
<span class="sd">same way as the regular scf method.  The density fitting scf object is an</span>
<span class="sd">independent object to the regular scf object which is to be decorated.  By</span>
<span class="sd">doing so, density fitting can be applied anytime, anywhere in your script</span>
<span class="sd">without affecting the exsited scf object.</span>

<span class="sd">See also:</span>
<span class="sd">examples/df/00-with_df.py</span>
<span class="sd">examples/df/01-auxbasis.py </span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;8  0  0.     0</span>
<span class="s1">              1  0  -0.757 0.587</span>
<span class="s1">              1  0  0.757  0.587&#39;&#39;&#39;</span><span class="p">,</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;ccpvdz&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">density_fit</span><span class="p">(</span><span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">))</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">, ref = -76.026744737355&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># Stream style: calling .density_fit method to return a DF-SCF object.</span>
<span class="c1">#</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">, ref = -76.026744737355&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>

<span class="c1">#</span>
<span class="c1"># By default optimal auxiliary basis (if possible) or even-tempered gaussian</span>
<span class="c1"># functions are used fitting basis.  You can assign with_df.auxbasis to change</span>
<span class="c1"># the change the fitting basis.</span>
<span class="c1">#</span>
<span class="n">mol</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">UKS</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="o">.</span><span class="n">auxbasis</span> <span class="o">=</span> <span class="s1">&#39;cc-pvdz-jkfit&#39;</span>
<span class="n">energy</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E = </span><span class="si">%.12f</span><span class="s1">, ref = -75.390366559552&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="section" id="customizing-hamiltonian">
<h3>Customizing Hamiltonian<a class="headerlink" href="#customizing-hamiltonian" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">ao2mo</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Customizing Hamiltonian for SCF module.</span>

<span class="sd">Three steps to define Hamiltonian for SCF:</span>
<span class="sd">1. Specify the number of electrons. (Note mole object must be &quot;built&quot; before doing this step)</span>
<span class="sd">2. Overwrite three attributes of scf object</span>
<span class="sd">    .get_hcore</span>
<span class="sd">    .get_ovlp</span>
<span class="sd">    ._eri</span>
<span class="sd">3. Specify initial guess (to overwrite the default atomic density initial guess)</span>

<span class="sd">Note you will see warning message on the screen:</span>

<span class="sd">        overwrite keys get_ovlp get_hcore of &lt;class &#39;pyscf.scf.hf.RHF&#39;&gt;</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">()</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">=</span> <span class="n">n</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">h1</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c1"># PBC</span>
<span class="n">eri</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">eri</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="n">mf</span><span class="o">.</span><span class="n">get_hcore</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">h1</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_ovlp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># ao2mo.restore(8, eri, n) to get 8-fold permutation symmetry of the integrals</span>
<span class="c1"># ._eri only supports the two-electron integrals in 4-fold or 8-fold symmetry.</span>
<span class="n">mf</span><span class="o">.</span><span class="n">_eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">eri</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="symmetry-in-casscf">
<h3>Symmetry in CASSCF<a class="headerlink" href="#symmetry-in-casscf" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1">#</span>
<span class="c1"># Author: Qiming Sun &lt;osirpt.sun@gmail.com&gt;</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">pyscf</span> <span class="k">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mcscf</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Symmetry is not immutable</span>

<span class="sd">In PySCF, symmetry is not built-in data structure.  Orbitals are stored in C1</span>
<span class="sd">symmetry.  The irreps and symmetry information are generated on the fly.</span>
<span class="sd">We can switch on symmetry for CASSCF solver even the Hartree-Fock is not</span>
<span class="sd">optimized with symmetry.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">Mole</span><span class="p">()</span>
<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;O&#39;</span> <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="mf">0.</span>     <span class="p">,</span> <span class="mf">0.</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">1</span>   <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="o">-</span><span class="mf">0.757</span> <span class="p">,</span> <span class="mf">0.587</span><span class="p">)],</span>
            <span class="p">[</span><span class="mi">1</span>   <span class="p">,</span> <span class="p">(</span><span class="mf">0.</span> <span class="p">,</span> <span class="mf">0.757</span>  <span class="p">,</span> <span class="mf">0.587</span><span class="p">)]],</span>
    <span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;cc-pvdz&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="n">mol</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">symmetry</span> <span class="o">=</span> <span class="s1">&#39;C2v&#39;</span><span class="p">)</span>
<span class="n">mc</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">mc</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral" title="An overview of PySCF" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-, Qiming Sun &lt;osirpt.sun@gmail.com&gt;.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>